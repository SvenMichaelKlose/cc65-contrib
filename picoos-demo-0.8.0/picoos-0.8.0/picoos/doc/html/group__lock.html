<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>pico]OS: Disable / Enable Interrupts</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>Disable / Enable Interrupts<br>
<small>
[<a class="el" href="group__configp.html">Configuration: Pico Layer</a>]</small>
</h1><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__lock.html#ga0">POSCFG_LOCK_USEFLAGS</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__lock.html#ga1">POSCFG_LOCK_FLAGSTYPE</a>&nbsp;&nbsp;&nbsp;register <a class="el" href="picoos_8h.html#a45">VAR_t</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__lock.html#ga2">POS_SCHED_LOCK</a>&nbsp;&nbsp;&nbsp;asm { PUSHF; CLI }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__lock.html#ga3">POS_SCHED_UNLOCK</a>&nbsp;&nbsp;&nbsp;asm POPF</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
The operating system must be able to disable the interrupts on the processor for a short time to get exclusive access to internal data structures. There are three possible ways to solve this:<br>
<p>
1) Most processors have assembler commands that directly allow disabling and enabling interrupts. When the operating system needs to get exclusive access to any data, it will disable interrupts, access the data and enable interrupts again. The disadvantage of this simple way is that if the processor had disabled interrupts before the OS entered the critical section, the OS will reenable the interrupts again after it left the critical section regardless if interrupts were disabled before.<br>
<p>
2) A better way is to save the current processor state before disabling interrupts. Much processors support a "push flags to stack" OP-Code for this purpose. When the operating system enters a critical section, it will push the processor flags to the stack and disables the interrupts. Then, when the operating system will left the critical section again, it simply restores the old processor state by popping the last processor state from the stack. If interrupts where enabled before, it just became enabled now.<br>
<p>
3) There are some processors which have no OP-code for directly pushing the processor flags (=PSW, Processor Status Word) directly to the stack. For this processors, you can define a local variable which will hold the original PSW when the operating system enters the critical section. If your processor has enough general purpose register, you may define the variable as register variable for fastest possible access. This is truly better than pushing the flags to the stack. <hr><h2>Define Documentation</h2>
<a class="anchor" name="ga2" doxytag="port.h::POS_SCHED_LOCK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POS_SCHED_LOCK&nbsp;&nbsp;&nbsp;asm { PUSHF; CLI }
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Scheduler locking. Locking the scheduler for a short time is done by disabling the interrupts on the processor. This macro can contain a subroutine call or a piece of assembler code that stores the processor state and disables the interrupts. See <a class="el" href="group__lock.html#ga1">POSCFG_LOCK_FLAGSTYPE</a> for more details.     </td>
  </tr>
</table>
<a class="anchor" name="ga3" doxytag="port.h::POS_SCHED_UNLOCK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POS_SCHED_UNLOCK&nbsp;&nbsp;&nbsp;asm POPF
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Scheduler unlocking. This is the counterpart macro of <a class="el" href="group__lock.html#ga2">POS_SCHED_LOCK</a>. It restores the saved processor flags and reenables the interrupts this way.     </td>
  </tr>
</table>
<a class="anchor" name="ga1" doxytag="port.h::POSCFG_LOCK_FLAGSTYPE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POSCFG_LOCK_FLAGSTYPE&nbsp;&nbsp;&nbsp;register <a class="el" href="picoos_8h.html#a45">VAR_t</a>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Define variable type for the processor flags. If <a class="el" href="group__lock.html#ga0">POSCFG_LOCK_USEFLAGS</a> is set to 1, this define must be set to the variable type that shall be used for the processor flags. In this example, the variable definition "register VAR_t flags;" would be added to each function using the macros <a class="el" href="group__lock.html#ga2">POS_SCHED_LOCK</a> and <a class="el" href="group__lock.html#ga3">POS_SCHED_UNLOCK</a>.     </td>
  </tr>
</table>
<a class="anchor" name="ga0" doxytag="port.h::POSCFG_LOCK_USEFLAGS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POSCFG_LOCK_USEFLAGS&nbsp;&nbsp;&nbsp;0
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Enable local flags variable. When this define is set to 1, a user defined variable will be generated for storing the current processor state before disabling interrupts. Then the define <a class="el" href="group__lock.html#ga1">POSCFG_LOCK_FLAGSTYPE</a> must be set to the type of variable to be used for the flags.     </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sun Mar 21 20:37:33 2004 for pico]OS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
